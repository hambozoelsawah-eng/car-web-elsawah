<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¹Ø±Ø¶ Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø³ÙˆØ§Ø­</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }

        body {
            background: #020c1f;
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(800px circle at 20% 30%, rgba(99,234,241,0.12) 0%, transparent 50%),
                radial-gradient(600px circle at 80% 70%, rgba(245,180,29,0.12) 0%, transparent 50%),
                radial-gradient(400px circle at 60% 30%, rgba(29,83,245,0.12) 0%, transparent 50%);
            z-index: -1;
            pointer-events: none;
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #63eaf1, #1d53f5);
            border-radius: 10px;
            border: 2px solid rgba(0,0,0,0.2);
        }

        .header {
            background: linear-gradient(150deg, rgba(3,20,22,0.98) 0%, rgba(19,25,34,0.98) 100%);
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 40px;
            height: 90px;
            position: sticky;
            top: 0;
            width: 100%;
            z-index: 1000;
            border-bottom: 2px solid rgba(99,234,241,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        }

        .logo {
            font-size: 36px;
            font-weight: 900;
            background: linear-gradient(135deg, #63eaf1, #1d53f5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 40px rgba(99,234,241,0.4);
            letter-spacing: 1px;
            transition: transform 0.3s;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .nav {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .nav li, .nav a li {
            list-style: none;
            color: rgba(255,255,255,0.85);
            padding: 14px 28px;
            border-radius: 15px;
            cursor: pointer;
            position: relative;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            font-size: 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .nav li:hover, .nav a li:hover {
            background: linear-gradient(135deg, rgba(99,234,241,0.25), rgba(29,83,245,0.25));
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(99,234,241,0.3);
            border-color: rgba(99,234,241,0.4);
        }

        a {
            text-decoration: none;
        }

        .toggle {
            width: 35px;
            height: 35px;
            cursor: pointer;
            transition: all 0.4s;
            filter: drop-shadow(0 0 8px rgba(99,234,241,0.5));
        }

        .menu {
            width: 380px;
            height: calc(100vh - 90px);
            overflow-y: auto;
            position: fixed;
            background: linear-gradient(150deg, rgba(3,20,22,0.98) 0%, rgba(19,25,34,0.98) 100%);
            backdrop-filter: blur(20px);
            z-index: 999;
            top: 90px;
            right: 0;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            transform: translateX(100%);
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border-right: 2px solid rgba(99,234,241,0.2);
            box-shadow: -10px 0 40px rgba(0,0,0,0.5);
        }

        .menu.active {
            transform: translateX(0);
        }

        .menu ul {
            list-style: none;
            padding: 0;
            margin-bottom: 20px;
        }

        .menu ul li {
            color: white;
            padding: 18px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            border-radius: 12px;
            background: rgba(255,255,255,0.03);
            margin-bottom: 10px;
        }

        .menu ul li:hover {
            background: linear-gradient(135deg, rgba(99,234,241,0.2), rgba(29,83,245,0.15));
            transform: translateX(-5px);
            box-shadow: 0 4px 15px rgba(99,234,241,0.2);
        }

        .menu-title {
            font-size: 1.4rem;
            font-weight: 800;
            margin-bottom: 15px;
            color: #63eaf1;
            text-shadow: 0 0 20px rgba(99,234,241,0.3);
        }

        .secret_code, .admin-form input, .admin-form textarea, .admin-form select {
            background: rgba(255,255,255,0.08);
            color: #fff;
            width: 100%;
            padding: 14px 18px;
            margin-top: 12px;
            border-radius: 12px;
            border: 2px solid rgba(99,234,241,0.2);
            outline: none;
            font-size: 15px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .secret_code:focus, .admin-form input:focus, .admin-form textarea:focus, .admin-form select:focus {
            border-color: #63eaf1;
            background: rgba(99,234,241,0.1);
            box-shadow: 0 0 20px rgba(99,234,241,0.2);
        }

        .admin-form button {
            background: linear-gradient(135deg, #1d53f5, #63eaf1);
            border: none;
            cursor: pointer;
            font-weight: 700;
            margin-top: 20px;
            transition: all 0.4s;
            padding: 16px;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            box-shadow: 0 6px 20px rgba(29,83,245,0.3);
            width: 100%;
        }

        .admin-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(29,83,245,0.5);
            background: linear-gradient(135deg, #63eaf1, #1d53f5);
        }

        #admin-panel-container {
            background: linear-gradient(150deg, rgba(10,20,40,0.95), rgba(15,25,45,0.95));
            padding: 25px;
            border-radius: 20px;
            margin-top: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            display: none;
            flex-direction: column;
            gap: 25px;
            border: 1px solid rgba(99,234,241,0.15);
        }

        .file-input-label {
            display: block;
            background: linear-gradient(135deg, rgba(99,234,241,0.15), rgba(29,83,245,0.15));
            color: #fff;
            padding: 16px;
            margin-top: 12px;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            border: 2px dashed rgba(99,234,241,0.4);
            transition: all 0.3s;
            font-weight: 600;
        }

        .file-input-label:hover {
            background: linear-gradient(135deg, rgba(99,234,241,0.25), rgba(29,83,245,0.25));
            border-color: #63eaf1;
            box-shadow: 0 5px 20px rgba(99,234,241,0.2);
        }

        .file-input-label input[type="file"] {
            display: none;
        }

        .file-status {
            margin-top: 8px;
            font-size: 0.95rem;
            color: #63eaf1;
            text-align: right;
            font-weight: 600;
        }

        .cars_shop {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 35px;
            padding: 50px 40px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .cars_shop.menu-collapsed {
            padding-right: 60px;
        }

        .cars {
            background: linear-gradient(145deg, rgba(15,25,40,0.95), rgba(10,20,35,0.95));
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            box-shadow: 
                0 10px 40px rgba(0,0,0,0.5),
                inset 0 1px 0 rgba(255,255,255,0.1);
            border: 1px solid rgba(99,234,241,0.15);
            position: relative;
        }

        .cars::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(99,234,241,0.1), rgba(29,83,245,0.1));
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 1;
            pointer-events: none;
        }

        .cars:hover::before {
            opacity: 1;
        }

        .cars:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 
                0 20px 60px rgba(99,234,241,0.4),
                0 0 40px rgba(29,83,245,0.3);
            border-color: rgba(99,234,241,0.5);
        }

        .cars img {
            width: 100%;
            height: 220px;
            object-fit: cover;
            filter: brightness(0.9);
            transition: all 0.6s ease;
        }

        .cars:hover img {
            transform: scale(1.1);
            filter: brightness(1.1);
        }

        .car-details-summary {
            padding: 20px;
            text-align: right;
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: relative;
            z-index: 2;
        }

        .car-details-summary h4 {
            font-size: 1.25rem;
            margin-bottom: 5px;
            color: #63eaf1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-weight: 800;
            text-shadow: 0 2px 10px rgba(99,234,241,0.3);
        }

        .car-details-summary p {
            font-weight: 400;
            font-size: 0.95rem;
            color: rgba(255,255,255,0.7);
            line-height: 1.6;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            white-space: normal;
        }

        .car-price {
            font-size: 1.6rem;
            font-weight: 900;
            background: linear-gradient(135deg, #33f51d, #007a18);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-top: 10px;
            border-top: 2px solid rgba(245,180,29,0.3);
            padding-top: 12px;
            text-shadow: 0 2px 10px rgba(245,180,29,0.3);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: linear-gradient(150deg, rgba(10,20,40,0.98), rgba(15,25,45,0.98));
            width: 95%;
            max-width: 1400px;
            height: 90%;
            max-height: 900px;
            border-radius: 25px;
            padding: 40px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(99,234,241,0.2);
            box-shadow: 0 20px 80px rgba(0,0,0,0.8);
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-close-btn {
            position: absolute;
            top: 25px;
            left: 25px;
            font-size: 2.5rem;
            color: white;
            cursor: pointer;
            background: rgba(255,255,255,0.1);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .modal-close-btn:hover {
            background: rgba(230,57,70,0.8);
            transform: rotate(90deg);
        }

        .car-info-section {
            padding-right: 20px;
            overflow-y: auto;
        }

        .car-info-section img {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: 20px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        .car-info-section h2 {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(135deg, #63eaf1, #1d53f5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }

        .ai-chat-section {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 0;
            border: 1px solid rgba(99,234,241,0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header-modal {
            padding: 20px;
            background: linear-gradient(135deg, #1a2537 0%, #0d1623 100%);
            border-bottom: 2px solid rgba(99, 234, 241, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 600;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .chat-messages {
            height: 400px;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: rgba(2, 12, 31, 0.5);
        }

        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: rgba(99, 234, 241, 0.3);
            border-radius: 3px;
        }

        .msg {
            padding: 14px 16px;
            border-radius: 12px;
            max-width: 85%;
            white-space: pre-line;
            animation: slideIn 0.3s ease;
            line-height: 1.6;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user {
            align-self: flex-end;
            background: linear-gradient(135deg, rgba(99,234,241,0.2) 0%, rgba(99,234,241,0.1) 100%);
            border: 1px solid rgba(99,234,241,0.3);
        }

        .bot {
            align-self: flex-start;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .typing {
            display: flex;
            gap: 4px;
            padding: 14px 16px;
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            max-width: 80px;
            align-self: flex-start;
        }

        .typing span {
            width: 8px;
            height: 8px;
            background: #63eaf1;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out;
        }

        .typing span:nth-child(1) { animation-delay: -0.32s; }
        .typing span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .chat-input {
            display: flex;
            gap: 10px;
            padding: 20px;
            border-top: 2px solid rgba(99, 234, 241, 0.3);
            background: rgba(7, 18, 39, 0.8);
        }

        .chat-input input {
            flex: 1;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.15);
            padding: 12px 16px;
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
            transition: all 0.3s;
        }

        .chat-input input:focus {
            outline: none;
            border-color: #63eaf1;
            background: rgba(255,255,255,0.08);
        }

        .chat-input input::placeholder {
            color: rgba(255,255,255,0.4);
        }

        .chat-input button {
            background: linear-gradient(135deg, #63eaf1 0%, #4dd4e0 100%);
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            color: #020c1f;
            transition: all 0.3s;
            font-size: 14px;
        }

        .chat-input button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 234, 241, 0.4);
        }

        .clear-btn {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 8px 16px;
            font-size: 13px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .clear-btn:hover {
            background: rgba(239, 68, 68, 0.3);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
        }

        .car-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(99, 234, 241, 0.2);
            border-radius: 10px;
            padding: 12px;
            margin: 8px 0;
        }

        .car-name {
            font-weight: 600;
            color: #63eaf1;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .car-details {
            font-size: 13px;
            line-height: 1.8;
            color: rgba(255,255,255,0.8);
        }

        .car-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .highlight {
            color: #4ade80;
            font-weight: 600;
        }

        .notification {
            position: fixed;
            top: 110px;
            right: 30px;
            padding: 18px 30px;
            border-radius: 15px;
            font-size: 1.05rem;
            color: #fff;
            z-index: 3000;
            box-shadow: 0 8px 30px rgba(0,0,0,0.6);
            font-weight: 600;
            border: 2px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
        }

        @media(max-width: 1200px) {
            .modal-content {
                grid-template-columns: 1fr;
                height: auto;
                max-height: 90vh;
                overflow-y: auto;
                padding: 30px;
            }
            
            .car-info-section {
                padding-right: 0;
            }
        }

        @media(max-width: 768px) {
            .header {
                padding: 0 20px;
                height: 70px;
            }

            .logo {
                font-size: 24px;
            }

            .nav {
                gap: 8px;
            }

            .nav li, .nav a li {
                padding: 10px 16px;
                font-size: 0.85rem;
            }

            .toggle {
                width: 30px;
                height: 30px;
            }

            .menu {
                width: 320px;
                top: 70px;
                height: calc(100vh - 70px);
                padding: 20px;
            }

            .cars_shop {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                padding: 30px 15px;
                gap: 20px;
            }

            .modal-content {
                padding: 20px;
            }

            .chat-messages {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø³ÙˆØ§Ø­</div>
        <nav class="nav">
            <img src="Frame 19.png" alt="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©" class="toggle" id="menu-toggle">
        </nav>
    </div>

    <div class="menu" id="side-menu">
        <div class="category-section" id="category-section">
            <h3 class="menu-title">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h3>
            <ul id="category-list">
                <a href="index.html"><li>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</li></a>
                <a href="#"><li>Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</li></a>
                <a href="ai.html"><li>Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§ÙŠ Ø´Ø¦ (AI)</li></a>
            </ul>
        </div>
        <input type="password" class="secret_code" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©" id="admin-code-input">

        <div id="admin-panel-container">
            <h3 class="menu-title" style="color:#f5b41d;">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
            <div class="admin-form">
                <h4>Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h4>
                <input type="text" id="car-name" placeholder="Ø§Ù„Ø§Ø³Ù… (Ù…Ø«Ø§Ù„: Ù…Ø±Ø³ÙŠØ¯Ø³ C200)">
                <input type="text" id="car-type" placeholder="Ø§Ù„Ù†ÙˆØ¹ (Ù…Ø«Ø§Ù„: Ø³ÙŠØ¯Ø§Ù†)">
                <input type="text" id="car-model" placeholder="Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ (Ù…Ø«Ø§Ù„: 2023)">
                <textarea id="car-description" placeholder="Ø§Ù„ÙˆØµÙ Ø§Ù„Ù…ÙØµÙ„" rows="3"></textarea>
                
                <select id="car-engine-type">
                    <option value="" disabled selected>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø±Ùƒ</option>
                    <option value="Ø¨Ù†Ø²ÙŠÙ†">Ø¨Ù†Ø²ÙŠÙ†</option>
                    <option value="Ø¯ÙŠØ²Ù„">Ø¯ÙŠØ²Ù„</option>
                    <option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ">ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ</option>
                    <option value="Ù‡Ø¬ÙŠÙ†">Ù‡Ø¬ÙŠÙ†</option>
                </select>
                <select id="car-transmission">
                    <option value="" disabled selected>Ù†Ø§Ù‚Ù„ Ø§Ù„Ø­Ø±ÙƒØ© (Ø§Ù„Ø¬ÙŠØ±)</option>
                    <option value="Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ">Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ</option>
                    <option value="ÙŠØ¯ÙˆÙŠ">ÙŠØ¯ÙˆÙŠ</option>
                </select>
                <input type="text" id="car-exterior-color" placeholder="Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ (Ù…Ø«Ø§Ù„: Ø£Ø²Ø±Ù‚ Ù…ÙŠØªØ§Ù„ÙŠÙƒ)">

                <select id="car-condition">
                    <option value="Ø¬Ø¯ÙŠØ¯Ø©">Ø¬Ø¯ÙŠØ¯Ø©</option>
                    <option value="Ù…Ø³ØªØ¹Ù…Ù„Ø©">Ù…Ø³ØªØ¹Ù…Ù„Ø©</option>
                </select>
                <input type="number" id="car-mileage" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±Ø§Øª (Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù…)">
                <input type="number" id="car-price" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù…)">
                
                <label for="car-image-file" class="file-input-label">
                    Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²
                    <input type="file" id="car-image-file" accept="image/*">
                </label>
                <div id="file-status" class="file-status">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ù„Ù</div>
                
                <button onclick="addCar()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</button>
            </div>
            <div class="admin-form" style="margin-top: 30px;">
                <h4>Ø¥Ø²Ø§Ù„Ø© Ø³ÙŠØ§Ø±Ø©</h4>
                <input type="text" id="car-delete-id" placeholder="Ø£Ø¯Ø®Ù„ ID Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù„Ù„Ø¥Ø²Ø§Ù„Ø©">
                <button style="background: linear-gradient(135deg, #e63946, #ff6b6b);" onclick="deleteCar()">Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</button>
            </div>
        </div>
    </div>

    <div class="cars_shop" id="cars-grid">
        <p style="grid-column: 1 / -1; text-align: center; color: rgba(255,255,255,0.7); font-size: 1.1rem;">Ø¬Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª...</p>
    </div>

    <div class="modal-overlay" id="car-details-modal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeCarDetails()">&times;</button>
            <div class="car-info-section" id="car-info-display"></div>
            <div class="ai-chat-section">
                <div class="chat-header-modal">
                    <div class="header-title">
                        <span class="status-dot"></span>
                        <div>Ù…Ø³Ø§Ø¹Ø¯ Elsawah AI (Gemini 2.5 Flash Ø¹Ø¨Ø± OpenRouter)</div>
                    </div>
                    <button class="clear-btn" onclick="clearChat()">Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</button>
                </div>
                <div id="chat-messages" class="chat-messages">
                    <div class="msg bot">Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ Elsawah AI Ø§Ù„Ø°ÙƒÙŠ ğŸš—

ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ:
â€¢ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù† Ø£Ø³Ø¦Ù„ØªÙƒ Ø­ÙˆÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø±Ø©
â€¢ Ù…Ù‚Ø§Ø±Ù†ØªÙ‡Ø§ Ù…Ø¹ Ø³ÙŠØ§Ø±Ø§Øª Ø£Ø®Ø±Ù‰
â€¢ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¹Ù† Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª
â€¢ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø£ÙŠ Ø´ÙŠØ¡ ÙŠØ®Øµ Ø§Ù„Ù…Ø¹Ø±Ø¶

ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ</div>
                </div>
                <div class="chat-input">
                    <input id="chat-input" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." type="text">
                    <button onclick="sendMessage()">Ø¥Ø±Ø³Ø§Ù„</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const supabaseUrl = "https://mgcbhtnhxyaybpmqmgny.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1nY2JodG5oeHlheWJwbXFtZ255Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4ODQ0NTgsImV4cCI6MjA3NDQ2MDQ1OH0.45IGnbt4zjlJCHVFApNaJ_13E4Iz0eea-XBrLR0-umg";
        const db = supabase.createClient(supabaseUrl, supabaseKey);

        const ADMIN_SECRET_CODE = 'car-share-elsawah';
        const SUPABASE_BUCKET = 'car-images';
        const SUPABASE_CAR_TABLE = 'cars';
        const SUPABASE_TYPE_COLUMN = 'type';
        
        // ====== OpenRouter API Ø¥Ø¹Ø¯Ø§Ø¯ ======
        // ğŸ”´ ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù…: ÙŠØ¬Ø¨ ÙˆØ¶Ø¹ Ù…ÙØªØ§Ø­ OpenRouter API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§ 
        // Ø§Ù„Ù…ÙØªØ§Ø­ ÙŠØ¨Ø¯Ø£ Ø¹Ø§Ø¯Ø© Ø¨Ù€ "sk-"
        const OPENROUTER_API_KEY = "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"; 
        
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ù…Ù† ai.html Ø§Ù„Ø°ÙŠ ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­
        const OPENROUTER_MODEL = "google/gemini-2.5-flash";
        
        const SHOWROOM_INFO = {
            name: "Ù…Ø¹Ø±Ø¶ Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø³ÙˆØ§Ø­",
            address: "Ù…ØµØ±-Ù‚Ø³Ù… Ø§ÙˆÙ„ Ø§Ù„ÙÙŠÙˆÙ… Ø´Ø§Ø±Ø¹ Ø§Ù„ÙˆØ±Ø´Ø© Ø§Ù…Ø§Ù… Ø§Ù„Ù…Ø¯Ø±ÙŠØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø®Ù„Ù Ù…Ø³Ø¬Ø¯ Ù†Ø§ØµØ±",
        };

        let isAdmin = false;
        let allLoadedCars = [];
        let currentCar = null;

        const menuToggle = document.getElementById('menu-toggle');
        const sideMenu = document.getElementById('side-menu');
        const carsGrid = document.getElementById('cars-grid');
        const adminCodeInput = document.getElementById('admin-code-input');
        const adminPanelContainer = document.getElementById('admin-panel-container');
        const fileInput = document.getElementById('car-image-file');
        const fileStatus = document.getElementById('file-status');
        const chatInput = document.getElementById('chat-input');
        const chatMessages = document.getElementById('chat-messages');

        adminPanelContainer.style.display = 'none';

        menuToggle.addEventListener('click', () => {
            sideMenu.classList.toggle('active');
            carsGrid.classList.toggle('menu-collapsed', !sideMenu.classList.contains('active'));
        });

        adminCodeInput.addEventListener('input', () => {
            if (adminCodeInput.value === ADMIN_SECRET_CODE) {
                adminCodeInput.style.display = 'none';
                adminPanelContainer.style.display = 'flex';
                isAdmin = true;
                showNotification('ØªÙ… ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                renderCars(allLoadedCars);
            } else if (adminCodeInput.value.length > 0) {
                adminPanelContainer.style.display = 'none';
            }
        });

        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                fileStatus.textContent = `ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù: ${fileInput.files[0].name}`;
            } else {
                fileStatus.textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ù„Ù';
            }
        });

        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        async function loadCars(category = 'All') {
            carsGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: rgba(255,255,255,0.7); font-size: 1.1rem;">Ø¬Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª...</p>';
            
            const { data: cars, error } = await db.from(SUPABASE_CAR_TABLE).select("*");

            if (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª:", error);
                carsGrid.innerHTML = `<p style="grid-column: 1 / -1; text-align: center; color: #e63946;">Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ${error.message}.</p>`;
                return;
            }

            allLoadedCars = cars;
            let filteredCars = allLoadedCars;
            if (category !== 'All') {
                filteredCars = allLoadedCars.filter(car => car[SUPABASE_TYPE_COLUMN] === category);
            }

            renderCars(filteredCars);
        }

        function renderCars(cars) {
            carsGrid.innerHTML = '';
            if (cars.length === 0) {
                carsGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: rgba(255,255,255,0.7); font-size: 1.1rem;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³ÙŠØ§Ø±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ù† Ø¬Ø±Ø¨ ÙÙŠ ÙˆÙ‚Øª Ù„Ø§Ø­Ù‚.</p>';
                return;
            }

            const adminIdStyle = `
                color: #f5b41d; font-weight: bold; margin-top: 8px; 
                background: rgba(245, 180, 29, 0.1); padding: 4px 8px; 
                border-radius: 6px; border: 1px solid rgba(245, 180, 29, 0.3);
            `;

            cars.forEach(car => {
                const carElement = document.createElement('div');
                carElement.className = 'cars';
                carElement.dataset.id = car.id;
                carElement.onclick = () => openCarDetails(car);
                
                let imageUrl = car.image_url;
                
                if (!imageUrl || imageUrl.trim() === '') {
                    imageUrl = 'https://via.placeholder.com/600x400/1a2332/63eaf1?text=Ù„Ø§+ØªÙˆØ¬Ø¯+ØµÙˆØ±Ø©';
                } else {
                    imageUrl = imageUrl.trim();
                }

                const carHTML = `
                    <img src="${imageUrl}" 
                         alt="${car.name || 'Ø³ÙŠØ§Ø±Ø©'}"
                         loading="lazy"
                         crossorigin="anonymous"
                         onerror="this.onerror=null; this.src='https://via.placeholder.com/600x400/1a2332/ff6b6b?text=ÙØ´Ù„+ØªØ­Ù…ÙŠÙ„+Ø§Ù„ØµÙˆØ±Ø©';">
                    <div class="car-details-summary">
                        <h4>${car.name || 'Ø³ÙŠØ§Ø±Ø© ØºÙŠØ± Ù…Ø³Ù…Ø§Ø©'} - ${car.model || ''}</h4>
                        <p>${car.description ? car.description.substring(0, 60) + '...' : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ.'}</p>
                        ${isAdmin ? `<div style="${adminIdStyle}">ID: ${car.id}</div>` : ''}
                        <div class="car-price">${car.price ? car.price.toLocaleString() + ' Ø¬Ù†ÙŠÙ‡' : 'Ø§Ù„Ø³Ø¹Ø± ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                    </div>
                `;
                
                carElement.innerHTML = carHTML;
                carsGrid.appendChild(carElement);
            });
        }

        window.onload = () => loadCars();

        async function uploadFileAndGetURL(file) {
            const fileExtension = file.name.split('.').pop().toLowerCase();
            const cleanFileName = file.name
                .replace(/\s+/g, '_')
                .replace(/[()[\]{}]/g, '')
                .replace(/[^\w.-]/g, '_')
                .substring(0, 50);
            
            const uniqueId = `${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;
            const fileName = `${uniqueId}.${fileExtension}`;
            const filePath = `${fileName}`;

            try {
                const { data: uploadData, error: uploadError } = await db.storage
                    .from(SUPABASE_BUCKET)
                    .upload(filePath, file, {
                        cacheControl: '3600',
                        upsert: false,
                        contentType: file.type
                    });

                if (uploadError) {
                    throw new Error(uploadError.message);
                }

                const { data: publicUrlData } = db.storage
                    .from(SUPABASE_BUCKET)
                    .getPublicUrl(filePath);

                if (!publicUrlData || !publicUrlData.publicUrl) {
                    throw new Error("ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¹Ø§Ù… Ø¨Ø¹Ø¯ Ø§Ù„Ø±ÙØ¹.");
                }

                return publicUrlData.publicUrl;
                
            } catch (e) {
                throw new Error(`ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹: ${e.message}`);
            }
        }

        async function addCar() {
            if (!isAdmin) return showNotification('ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø£ÙˆÙ„Ø§Ù‹.', 'error');
            
            const file = document.getElementById('car-image-file').files[0];
            let imageUrl = 'https://placehold.co/600x400/0a1428/ffffff?text=Car+Image';
            
            if (file) {
                try {
                    showNotification('Ø¬Ø§Ø± Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...', 'info');
                    imageUrl = await uploadFileAndGetURL(file);
                    showNotification('ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­.', 'success');
                } catch (e) {
                    showNotification(`Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©: ${e.message}. Ù„Ù† ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø©.`, 'error');
                }
            }

            const carData = {
                name: document.getElementById('car-name').value,
                [SUPABASE_TYPE_COLUMN]: document.getElementById('car-type').value,
                model: document.getElementById('car-model').value,
                description: document.getElementById('car-description').value,
                engine_type: document.getElementById('car-engine-type').value,
                transmission: document.getElementById('car-transmission').value,
                exterior_color: document.getElementById('car-exterior-color').value,
                condition: document.getElementById('car-condition').value,
                mileage_km: parseInt(document.getElementById('car-mileage').value) || 0,
                price: parseInt(document.getElementById('car-price').value) || 0,
                image_url: imageUrl,
                currency: 'L.E',
            };

            if (!carData.name || !carData.price || !carData[SUPABASE_TYPE_COLUMN]) {
                return showNotification('Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù†ÙˆØ¹ØŒ ÙˆØ§Ù„Ø³Ø¹Ø± Ù…Ø·Ù„ÙˆØ¨ÙˆÙ† Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø©.', 'error');
            }
            
            const { error } = await db.from(SUPABASE_CAR_TABLE).insert([carData]);

            if (error) {
                showNotification(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ${error.message}`, 'error');
            } else {
                showNotification('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                loadCars();
                document.querySelectorAll('.admin-form input:not([type="file"]), .admin-form textarea, .admin-form select').forEach(el => el.value = el.defaultValue || '');
                document.getElementById('car-image-file').value = '';
                fileStatus.textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ù„Ù';
            }
        }

        async function deleteCar() {
            if (!isAdmin) return showNotification('ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø£ÙˆÙ„Ø§Ù‹.', 'error');

            const carIdToDelete = document.getElementById('car-delete-id').value;
            if (!carIdToDelete) return showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ID Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù„Ù„Ø¥Ø²Ø§Ù„Ø©.', 'error');

            const { error } = await db.from(SUPABASE_CAR_TABLE).delete().eq('id', carIdToDelete);

            if (error) {
                showNotification(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù: ${error.message}`, 'error');
            } else {
                showNotification(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø°Ø§Øª ID: ${carIdToDelete} Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
                loadCars();
                document.getElementById('car-delete-id').value = '';
            }
        }

        function showNotification(message, type = 'info', duration = 4000) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.className = 'notification';

            if (type === 'success') {
                notification.style.background = 'linear-gradient(135deg, #25d366, #20ba5a)';
            } else if (type === 'error') {
                notification.style.background = 'linear-gradient(135deg, #e63946, #ff6b6b)';
            } else if (type === 'warning') {
                notification.style.background = 'linear-gradient(135deg, #f5b41d, #ffd700)';
            } else {
                notification.style.background = 'linear-gradient(135deg, #1d53f5, #63eaf1)';
            }

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateY(0)';
            }, 10);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(20px)';
                notification.addEventListener('transitionend', () => notification.remove());
            }, duration);
        }

        function openCarDetails(car) {
            currentCar = car;
            let modalImageUrl = car.image_url;
            
            if (!modalImageUrl || modalImageUrl.trim() === '') {
                modalImageUrl = 'https://images.unsplash.com/photo-1542362567-b07e54358753?w=600&h=400&fit=crop';
            } else {
                modalImageUrl = modalImageUrl.trim();
            }
            
            document.getElementById('car-info-display').innerHTML = `
                <img src="${modalImageUrl}" 
                     alt="${car.name}" 
                     loading="lazy"
                     onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1542362567-b07e54358753?w=600&h=400&fit=crop&q=80';">
                <h2>${car.name || 'Ø³ÙŠØ§Ø±Ø©'} - ${car.model || ''}</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px; font-size: 1.05rem; border-top: 2px solid rgba(99,234,241,0.3); padding-top: 20px;">
                    <p style="color: #63eaf1; font-weight: 700;">Ø§Ù„Ø³Ø¹Ø±:</p> 
                    <p style="font-weight: 600;">${car.price ? car.price.toLocaleString() + ' ' + (car.currency || 'L.E') : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    
                    <p style="color: #63eaf1; font-weight: 700;">Ø§Ù„Ù†ÙˆØ¹:</p> 
                    <p>${car[SUPABASE_TYPE_COLUMN] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    
                    <p style="color: #63eaf1; font-weight: 700;">Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„:</p> 
                    <p>${car.model || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    
                    <p style="color: #63eaf1; font-weight: 700;">Ø§Ù„Ø­Ø§Ù„Ø©:</p> 
                    <p>${car.condition || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    
                    <p style="color: #63eaf1; font-weight: 700;">Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±Ø§Øª:</p> 
                    <p>${car.mileage_km ? car.mileage_km.toLocaleString() : '0'} ÙƒÙ…</p>
                    
                    <p style="color: #63eaf1; font-weight: 700;">Ù„ÙˆÙ† Ø§Ù„Ø³ÙŠØ§Ø±Ø©:</p> 
                    <p>${car.exterior_color || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    
                    <p style="color: #63eaf1; font-weight: 700;">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø±Ùƒ:</p> 
                    <p>${car.engine_type || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    
                    <p style="color: #63eaf1; font-weight: 700;">Ù†Ø§Ù‚Ù„ Ø§Ù„Ø­Ø±ÙƒØ©:</p> 
                    <p>${car.transmission || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                </div>
                <h3 style="margin-top: 30px; color: #f5b41d; font-weight: 800; font-size: 1.4rem;">Ø§Ù„ÙˆØµÙ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ:</h3>
                <p style="font-size: 1.05rem; color: rgba(255,255,255,0.85); line-height: 1.8; margin-top: 10px;">${car.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù…ÙØµÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø±Ø©.'}</p>
            `;
            
            // Reset chat
            chatMessages.innerHTML = `<div class="msg bot">Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ Elsawah AI Ø§Ù„Ø°ÙƒÙŠ ğŸš—

ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ:
â€¢ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù† Ø£Ø³Ø¦Ù„ØªÙƒ Ø­ÙˆÙ„ ${car.name || 'Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø±Ø©'}
â€¢ Ù…Ù‚Ø§Ø±Ù†ØªÙ‡Ø§ Ù…Ø¹ Ø³ÙŠØ§Ø±Ø§Øª Ø£Ø®Ø±Ù‰
â€¢ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¹Ù† Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª
â€¢ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø£ÙŠ Ø´ÙŠØ¡ ÙŠØ®Øµ Ø§Ù„Ù…Ø¹Ø±Ø¶

ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ</div>`;
            
            document.getElementById('car-details-modal').style.display = 'flex';
        }

        function closeCarDetails() {
            document.getElementById('car-details-modal').style.display = 'none';
            currentCar = null;
        }

        function clearChat() {
            chatMessages.innerHTML = `<div class="msg bot">ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©! ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„Ø¢Ù†ØŸ</div>`;
        }

        function addMsg(text, cls) {
            const d = document.createElement('div');
            d.className = `msg ${cls}`;
            d.innerHTML = text;
            chatMessages.appendChild(d);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTyping() {
            const typing = document.createElement('div');
            typing.className = 'typing';
            typing.id = 'typing-indicator';
            typing.innerHTML = '<span></span><span></span><span></span>';
            chatMessages.appendChild(typing);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTyping() {
            const typing = document.getElementById('typing-indicator');
            if (typing) typing.remove();
        }

        function buildCarsList(cars) {
            if (!cars || cars.length === 0) return '';
            
            return cars.map(c => `
Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ${c.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} ${c.model || ''}
Ø§Ù„Ø³Ø¹Ø±: ${c.price || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} ${c.currency || 'Ø¬Ù†ÙŠÙ‡'}
Ø§Ù„Ø­Ø§Ù„Ø©: ${c.condition || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø±Ùƒ: ${c.engine_type || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ: ${c.exterior_color || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±Ø§Øª: ${c.mileage_km || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} ÙƒÙ…
Ø§Ù„ÙˆØµÙ: ${c.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}
---`).join('\n');
        }

        function formatCarResponse(cars) {
            if (!cars || cars.length === 0) return '';
            
            let html = '<div style="margin-top: 10px;">';
            cars.forEach(c => {
                const imageUrl = c.image_url || 'https://placehold.co/600x400/0a1428/ffffff?text=No+Image';
                html += `
                    <div class="car-card">
                        <img src="${imageUrl}" alt="${c.name || 'ØµÙˆØ±Ø© Ø³ÙŠØ§Ø±Ø©'}">
                        <div class="car-name">${c.name || 'Ø³ÙŠØ§Ø±Ø©'} ${c.model || ''}</div>
                        <div class="car-details">
                            <div><span class="highlight">Ø§Ù„Ø³Ø¹Ø±:</span> ${c.price || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} ${c.currency || 'Ø¬Ù†ÙŠÙ‡'}</div>
                            <div><span class="highlight">Ø§Ù„Ø­Ø§Ù„Ø©:</span> ${c.condition || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                            <div><span class="highlight">Ø§Ù„Ù…Ø­Ø±Ùƒ:</span> ${c.engine_type || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                            <div><span class="highlight">Ø§Ù„Ù„ÙˆÙ†:</span> ${c.exterior_color || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                            <div><span class="highlight">Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±Ø§Øª:</span> ${c.mileage_km || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} ÙƒÙ…</div>
                            ${c.description ? `<div style="margin-top: 8px; color: rgba(255,255,255,0.7);">${c.description}</div>` : ''}
                        </div>
                    </div>`;
            });
            html += '</div>';
            return html;
        }

        /**
         * Ø¯Ø§Ù„Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¥Ù„Ù‰ OpenRouter API
         */
        async function askOpenRouter(prompt) {
            if (!OPENROUTER_API_KEY || OPENROUTER_API_KEY.length < 10) {
                return "âš ï¸ Ø®Ø·Ø£ Ø­Ø±Ø¬: Ù„Ù… ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† Ù…ÙØªØ§Ø­ OpenRouter API. Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙˆØ¶Ø¹ Ù…ÙØªØ§Ø­Ùƒ Ø§Ù„Ø®Ø§Øµ (Ø§Ù„Ø°ÙŠ ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 'sk-') ÙÙŠ Ø§Ù„Ù…ØªØºÙŠØ± 'OPENROUTER_API_KEY' Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ØŒ Ø«Ù… Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.";
            }

            const messages = [
                { role: "user", content: prompt }
            ];

            try {
                // Ø¥Ø¶Ø§ÙØ© timeout Ù„Ù„Ø·Ù„Ø¨ (30 Ø«Ø§Ù†ÙŠØ©)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000);

                const resp = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${OPENROUTER_API_KEY}`,
                        "Content-Type": "application/json",
                        "HTTP-Referer": window.location.href,
                    },
                    body: JSON.stringify({
                        model: OPENROUTER_MODEL,
                        messages: messages,
                        temperature: 0.7,
                        max_tokens: 800,
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!resp.ok) {
                    console.error('OpenRouter API Error:', resp.status, resp.statusText);
                    const errorData = await resp.text();
                    console.error('Error details:', errorData);
                    
                    let errorMessage = `Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ OpenRouter API: ${resp.statusText}.`;
                    try {
                        const errorJson = JSON.parse(errorData);
                        if (errorJson.error && errorJson.error.message) {
                            errorMessage += ` Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…: ${errorJson.error.message}`;
                        } else if (errorJson.message) {
                            errorMessage += ` Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…: ${errorJson.message}`;
                        }
                    } catch {
                        // Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù„ÙŠÙ„ JSON
                    }
                    
                    if (resp.status === 401) {
                        errorMessage += ` ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù…ÙØªØ§Ø­ OpenRouter API ØµØ­ÙŠØ­ ÙˆØµØ§Ù„Ø­ ÙˆÙ„Ø¯ÙŠÙ‡ Ø±ØµÙŠØ¯ ÙƒØ§Ù.`;
                    }

                    return errorMessage;
                }
                
                const data = await resp.json();
                console.log('OpenRouter Response:', data);
                
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    return data.choices[0].message.content;
                } else {
                    console.error('Unexpected response structure:', data);
                    throw new Error('Invalid response structure from OpenRouter');
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    return "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø§Ø³ØªØºØ±Ù‚ Ø§Ù„Ø·Ù„Ø¨ ÙˆÙ‚ØªØ§Ù‹ Ø·ÙˆÙŠÙ„Ø§Ù‹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø£Ùˆ ØªØ¨Ø³ÙŠØ· Ø§Ù„Ø³Ø¤Ø§Ù„.";
                }
                console.error('OpenRouter Error:', error);
                return "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ (Ø±Ø¨Ù…Ø§ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©). ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
            }
        }

        async function sendMessage() {
            const text = chatInput.value.trim();
            if (!text) return;
            
            addMsg(text, 'user');
            chatInput.value = '';
            showTyping();

            await new Promise(resolve => setTimeout(resolve, 500));

            if (allLoadedCars.length === 0) {
                await loadCars();
            }

            const allCarsText = buildCarsList(allLoadedCars);
            const currentCarText = currentCar ? `
Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø§Ù„ØªÙŠ ÙŠØ´Ø§Ù‡Ø¯Ù‡Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:
Ø§Ù„Ø§Ø³Ù…: ${currentCar.name}
Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„: ${currentCar.model}
Ø§Ù„Ø³Ø¹Ø±: ${currentCar.price} ${currentCar.currency || 'Ø¬Ù†ÙŠÙ‡'}
Ø§Ù„Ø­Ø§Ù„Ø©: ${currentCar.condition}
Ø§Ù„Ù…Ø­Ø±Ùƒ: ${currentCar.engine_type}
Ø§Ù„Ù„ÙˆÙ†: ${currentCar.exterior_color}
Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±Ø§Øª: ${currentCar.mileage_km} ÙƒÙ…
Ø§Ù„ÙˆØµÙ: ${currentCar.description}
` : '';
            
            const systemPrompt = `Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù„Ø¹Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©. Ù„Ø¯ÙŠÙƒ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:
Ø§Ø³Ù…Ùƒ: Ù…Ø³Ø§Ø¹Ø¯ Elsawah AI
Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¹Ø±Ø¶:
- Ø§Ù„Ø§Ø³Ù…: ${SHOWROOM_INFO.name}
- Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${SHOWROOM_INFO.address}

${currentCarText}

Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ (${allLoadedCars.length} Ø³ÙŠØ§Ø±Ø©):
${allCarsText}

ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù…Ù‡Ù…Ø©:
1.Ù„Ø§ ØªØ¹Ø±Ø¶ Ø§ÙŠ Ø³ÙŠØ§Ø±Ø© ØºÙŠØ± Ø§Ù„Ù…ØªÙˆÙØ±Ø© Ø­Ø§Ù„ÙŠØ§ 
2.Ø·Ø±Ù‚ Ø§Ù„ØªÙ‚Ø³ÙŠØ· 1Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ù†ÙˆÙƒ Ù…Ø¹ ÙƒØ§ÙØ© Ø¨Ù†ÙˆÙƒ Ù…ØµØ± 2Ø´Ø±ÙƒØ§Øª Ø§Ù„ØªÙ‚Ø³ÙŠØ· Ø§ÙƒØ¨Ø± Ø´Ø±ÙƒØ§Øª Ø§Ù„ØªÙ‚Ø³ÙŠØ· ÙÙŠ Ù…ØµØ± 3ØªÙ‚Ø³ÙŠØ· Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù…Ø¹Ø±Ø¶
3. Ø§Ø°Ø§ Ø³Ø§Ù„ Ù‡Ù„ Ù‡Ù†Ø§Ùƒ Ø§ÙŠ ÙØµØ§Ù„ ÙÙŠ Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ø°Ø§ Ù‚Ø§Ù„Ù‡Ø§ Ø¨Ø§ÙŠ Ø·Ø±ÙŠÙ‚Ø© Ù…Ø«Ù„ ÙÙŠ Ù…ØµØ± ÙŠÙ‚ÙˆÙ„Ù†Ù‡Ø§ Ù‡Ù„ Ù‡Ù†Ø§Ùƒ ÙƒÙ„Ø§Ù… Ø§Ùˆ ÙÙŠ ÙƒÙ„Ø§Ù… ÙÙŠ Ø§Ù„Ø³Ø¹Ø± ØªÙ‚ÙˆÙ„ Ù„Ù‡ Ø¨Ø§Ø¯Ø¨ ØªØ¹Ø§Ù„ÙŠ ÙˆÙ…Ø´ Ù‡Ù†Ø®ØªÙ„Ù Ø¨Ø£Ø°Ù† Ø§Ù„Ù„Ù‡
4.Ø­Ø§ÙˆÙ„ ØªØªÙƒÙ„Ù… Ù…ØµØ±ÙŠ Ø¨Ø³ Ù…ØªÙƒÙ†Ø´ Ø´Ø¹Ø¨ÙŠ Ø§ÙˆÙŠ
5.Ù…ØªØ¹Ø±Ø¶Ø´ Ø§ÙŠ Ø¹Ø±Ø¨ÙŠØ© ØºÙŠØ± Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù…Ù†Ùƒ
6.Ù„Ø§ ØªÙƒØ±Ø± Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø¹Ø±Ø¶
Ø§Ù„Ø³Ø¤Ø§Ù„: ${text}

Ø£Ø¬Ø¨ Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­ ÙˆÙ…ÙÙŠØ¯:`;

            try {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù€ OpenRouter
                const answer = await askOpenRouter(systemPrompt);
                hideTyping();
                
                // Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø¯ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØªÙØ§ØµÙŠÙ„ Ø³ÙŠØ§Ø±Ø§Øª Ù…Ø­Ø¯Ø¯Ø©
                const mentionedCars = allLoadedCars.filter(car => 
                    answer.includes(car.name) || answer.includes(car.model)
                );
                
                let finalResponse = answer;
                if (mentionedCars.length > 0 && mentionedCars.length <= 3) {
                    finalResponse += formatCarResponse(mentionedCars);
                }
                
                addMsg(finalResponse, 'bot');
            } catch (error) {
                hideTyping();
                addMsg('Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'bot');
            }
        }
    </script>
</body>
</html>